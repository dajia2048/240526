---
title: 'Eleventy Post Graph Plugin'
categories: ['RobbKnight']
keywords: ['RobbKnight']
date: 2023-12-19T15:10:02.341+00:00
lastmod: 2023-12-19T15:10:02.341+00:00
author: [['RobbKnight']]
tags: ['RobbKnight']
draft: false 
comments: true
reward: true 
mermaid: true 
showToc: true 
TocOpen: true 
hidemeta: false 
disableShare: true 
showbreadcrumbs: true 
cover:
    image: cdn.g0f.cn/?r=https://rknight.me&url=https://rknightuk.s3.amazonaws.com/site/eleventy-plugin-post-graph-screenshot.png
    alt: "Eleventy Post Graph Plugin"
    relative: false
---

<div>

<p>Last week I <a href="https://social.lol/@robb/111586346073402453">tooted about my Github-style post graph</a> on <a href="https://rknight.me/blog/stats">my stats page</a> and people seemed to like it. <a href="https://jamesdoc.com/blog/">James</a> added one to his blog pages. <a href="https://social.lol/@pimoore/111586392676224177">Pete swore at me</a>. I knew I had to make it into an Eleventy plugin so other people could us it easily.</p>
<p><img alt="Screenshot of eleventy-plugin-post-graph" src="cdn.g0f.cn/?r=https://rknight.me&url=https://rknightuk.s3.amazonaws.com/site/eleventy-plugin-post-graph-screenshot.png"/></p>
<p>If you just want to jump straight into using it, <a href="https://postgraph.rknight.me">check out the docs here</a>.</p>
<p>To create the data, which days have posts, and the grid itself I'm using <code>moment.js</code> to manipulate post dates<sup class="footnote-ref"><a href="https://rknight.me/feed.xml#fn1" id="fnref1">[1]</a></sup> and generate an object that looks something like this:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> postMap <span class="token operator">=</span> <span class="token punctuation">&#123;</span><br/>    <span class="token literal-property property">years</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><br/>        <span class="token number">2023</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><br/>            <span class="token literal-property property">days</span><span class="token operator">:</span> <span class="token number">365</span><span class="token punctuation">,</span><br/>            <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">6</span><br/>        <span class="token punctuation">&#125;</span><br/>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><br/>    <span class="token literal-property property">counts</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><br/>        <span class="token string-property property">'2023-1'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br/>        <span class="token string-property property">'2023-5'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><br/>        <span class="token comment">// and so on</span><br/>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><br/><span class="token punctuation">&#125;</span></code></pre>
<p><code>days</code> is the number of days in the year and <code>offset</code> is used to start the grid on the correct day; if the 1st of January is a Sunday, the offset is 6. The keys in <code>counts</code> are the year plus the <em>day of the year</em>. This makes it easy to check if a day should be highlighted or not:</p>
<pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"$&#123;prefix&#125;__squares"</span><span class="token operator">&gt;</span><br/>$<span class="token punctuation">&#123;</span><br/>    <span class="token comment">// generate the offset of the start of year</span><br/>    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">length</span><span class="token operator">:</span> postMap<span class="token punctuation">.</span>years<span class="token punctuation">[</span>year<span class="token punctuation">]</span><span class="token punctuation">.</span>offset <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">&#123;</span><br/>        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class="epg__box epg__box--empty"&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><br/>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><br/><span class="token punctuation">&#125;</span><br/>$<span class="token punctuation">&#123;</span><br/>    <span class="token comment">// make a box for every day of the year</span><br/>    <span class="token comment">// if at least one post exists, highlight that box</span><br/>    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">length</span><span class="token operator">:</span> postMap<span class="token punctuation">.</span>years<span class="token punctuation">[</span>year<span class="token punctuation">]</span><span class="token punctuation">.</span>days <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">&#123;</span><br/>        <span class="token keyword">const</span> dateIndexKey <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>year<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><br/>        <span class="token keyword">const</span> postCount <span class="token operator">=</span> postMap<span class="token punctuation">.</span>counts<span class="token punctuation">[</span>dateIndexKey<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><br/>        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class="epg__box </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span> postCount <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">epg__hasPost</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span> <span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">"&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><br/>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><br/><span class="token punctuation">&#125;</span><br/><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code></pre>
<p>One edge case I hadn't considered until I was writing the docs was what if someone wanted two instances of the graph in different colors - the css injected into the page would apply to both. The solution I came up with was to add a <code>prefix</code> option wherein the classes, instead of being <code>epg__&#123;something&#125;</code>, will become <code>mycoolprefix-epg__&#123;something&#125;</code>.</p>
<p>I added a bunch of other options to handle all the different use cases I could think of but I'm sure they'll be more. Get started with <a href="https://postgraph.rknight.me/">the docs</a> and if you use this on your site let me know, I'd love to see it.</p>
<hr class="footnotes-sep"/>
<section class="footnotes">
<ol class="footnotes-list">
<li class="footnote-item" id="fn1"><p>I am aware that <a href="https://day.js.org">Day.js</a> is better but I just...forgot about it until right now <a class="footnote-backref" href="https://rknight.me/feed.xml#fnref1">⤾</a></p>
</li>
</ol>
</section>

</div>

<div>
[原文](https://rknight.me/blog/eleventy-post-graph-plugin/)
</div>

