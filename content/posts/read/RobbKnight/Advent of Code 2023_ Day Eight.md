---
title: 'Advent of Code 2023: Day Eight'
categories: ['RobbKnight']
keywords: ['RobbKnight']
date: 2023-12-08T15:05:58.956+00:00
lastmod: 2023-12-08T15:05:58.956+00:00
author: [['RobbKnight']]
tags: ['RobbKnight']
draft: false 
comments: true
reward: true 
mermaid: true 
showToc: true 
TocOpen: true 
hidemeta: false 
disableShare: true 
showbreadcrumbs: true 
cover:
    image: https://www.g0f.cn/img/banner.jpg
    alt: "Advent of Code 2023: Day Eight"
    relative: false
---

<div>

<p>We've navigating a network today for...reasons.</p>
<h3>Part One</h3>
<p>The sample input looks like so:</p>
<pre class="language-text"><code class="language-text">RL<br/><br/>AAA = (BBB, CCC)<br/>BBB = (DDD, EEE)<br/>CCC = (ZZZ, GGG)<br/>DDD = (DDD, DDD)<br/>EEE = (EEE, EEE)<br/>GGG = (GGG, GGG)<br/>ZZZ = (ZZZ, ZZZ)</code></pre>
<p>The first line is a list of instructions (left or right) and the rest is the nodes with their left and right defined. So if we go right from <code>AAA</code>, we move to <code>CCC</code>, then left from there takes us to <code>ZZZ</code>. The puzzle is to count how many steps it takes to get to <code>ZZZ</code>.</p>
<p>I did a bunch of string replacement and exploding to get the output in a format I wanted:</p>
<pre class="language-php"><code class="language-php"><span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">array_filter</span><span class="token punctuation">(</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><br/><span class="token variable">$instructions</span> <span class="token operator">=</span> <span class="token function">str_split</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><br/><span class="token variable">$elements</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$input</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br/>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' = '</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/>    <span class="token variable">$elementKey</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/>    <span class="token punctuation">[</span><span class="token variable">$L</span><span class="token punctuation">,</span> <span class="token variable">$R</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">')'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'('</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/>    <span class="token variable">$elements</span><span class="token punctuation">[</span><span class="token variable">$elementKey</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'L'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'R'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">&#125;</span><br/><br/><span class="token comment">// [</span><br/><span class="token comment">//    'AAA' =&gt; [ 'L' =&gt; 'BBB', 'R' =&gt; 'CCC' ],</span><br/><span class="token comment">//    'BBB' =&gt; [ 'L' =&gt; 'DDD', 'R' =&gt; 'EEE' ],</span><br/><span class="token comment">//    ...</span><br/><span class="token comment">// ]</span></code></pre>
<p>One other part of this is that you may not get to <code>ZZZ</code> with the set of instructions. So if you hit the end, go back to the start of the instructions. I set the starting values and counters then while <code>found</code> is false, I incremenent the instruction index until we hit <code>ZZZ</code>:</p>
<pre class="language-php"><code class="language-php"><span class="token variable">$element</span> <span class="token operator">=</span> <span class="token function">array_key_first</span><span class="token punctuation">(</span><span class="token variable">$elements</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token variable">$found</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><br/><span class="token variable">$instructionIndex</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br/><span class="token variable">$steps</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br/><br/><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$found</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br/>    <span class="token comment">// if we're at the end of the instructions, go back to the start</span><br/>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$instructionIndex</span> <span class="token operator">===</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$instructions</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br/>        <span class="token variable">$instructionIndex</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br/>    <span class="token punctuation">&#125;</span><br/>    <span class="token variable">$instruction</span> <span class="token operator">=</span> <span class="token variable">$instructions</span><span class="token punctuation">[</span><span class="token variable">$instructionIndex</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/>    <span class="token variable">$element</span> <span class="token operator">=</span> <span class="token variable">$elements</span><span class="token punctuation">[</span><span class="token variable">$element</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$instruction</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$element</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'ZZZ'</span><span class="token punctuation">)</span><br/>    <span class="token punctuation">&#123;</span><br/>        <span class="token variable">$found</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><br/>    <span class="token punctuation">&#125;</span><br/><br/>    <span class="token variable">$instructionIndex</span><span class="token operator">++</span><span class="token punctuation">;</span><br/>    <span class="token variable">$steps</span><span class="token operator">++</span><span class="token punctuation">;</span><br/><span class="token punctuation">&#125;</span><br/><br/><span class="token keyword">echo</span> <span class="token string single-quoted-string">'It takes '</span> <span class="token operator">.</span> <span class="token variable">$steps</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' steps to reach ZZZ'</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span></code></pre>
<p>I ran it on the real input and I got stuck in an infinite loop. Initially I didn't read the instructions properly so I was starting at whatever the first node was; in the samples, this is always <code>AAA</code> but in the real input, it <em>isn't</em>. I stepped back and re-read what I was supposed to be doing and fixed this:</p>
<pre class="language-diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> $element = array_key_first($elements);<br/></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> $element = 'AAA';</span></span></code></pre>
<p>Re-ran it and it worked perfectly.</p>
<h3>Part Two</h3>
<p>For part two there some story about a ghost or whatever, but the crux of it is we need to follow multiple paths starting at all node that end with an <code>A</code>. We're only done when all the nodes for all paths end in a <code>Z</code>. I updated my formatting code to account for this:</p>
<pre class="language-diff"><code class="language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> $startingElements = [];<br/></span></span>$elements = [];<br/>foreach ($input as $value) &#123;<br/><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   $data = explode(' = ', $value);<br/></span><span class="token prefix unchanged"> </span><span class="token line">   $elementKey = $data[0];<br/></span><span class="token prefix unchanged"> </span><span class="token line">   [$L, $R] = explode(', ', str_replace(')', '', str_replace('(', '', $data[1])));<br/></span><span class="token prefix unchanged"> </span><span class="token line">   $elements[$elementKey] = compact('L', 'R');<br/></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    if (str_ends_with($elementKey, 'A'))&#123;<br/></span><span class="token prefix inserted">+</span><span class="token line">        $startingElements[] = $elementKey;<br/></span><span class="token prefix inserted">+</span><span class="token line">    &#125;<br/></span></span>&#125;</code></pre>
<p>For the new sample input gave me two starting points (the real input has five):</p>
<pre class="language-php"><code class="language-php"><span class="token variable">$test</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'LR<br/><br/>11A = (11B, XXX)<br/>11B = (XXX, 11Z)<br/>11Z = (11B, XXX)<br/>22A = (22B, XXX)<br/>22B = (22C, 22C)<br/>22C = (22Z, 22Z)<br/>22Z = (22B, 22B)<br/>XXX = (XXX, XXX)'</span><span class="token punctuation">;</span><br/><br/><span class="token comment">// ...</span><br/><br/><span class="token punctuation">[</span><br/>    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'11A'</span><span class="token punctuation">,</span><br/>    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'22A'</span><span class="token punctuation">,</span><br/><span class="token punctuation">]</span></code></pre>
<p>Next I updated my instruction loop to go through each starting point, get the next element for all of them, then check if they all the found elements end with a <code>Z</code>:</p>
<pre class="language-php"><code class="language-php"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$found</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br/>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$instructionIndex</span> <span class="token operator">===</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$instructions</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br/>        <span class="token variable">$instructionIndex</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br/>    <span class="token punctuation">&#125;</span><br/>    <span class="token variable">$foundElements</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/>    <span class="token variable">$instruction</span> <span class="token operator">=</span> <span class="token variable">$instructions</span><span class="token punctuation">[</span><span class="token variable">$instructionIndex</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/>    <span class="token variable">$check</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><br/>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$elementRange</span> <span class="token keyword">as</span> <span class="token variable">$er</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br/>        <span class="token variable">$el</span> <span class="token operator">=</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$nextElements</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$startingElements</span><span class="token punctuation">[</span><span class="token variable">$er</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token variable">$nextElements</span><span class="token punctuation">[</span><span class="token variable">$er</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/>        <span class="token variable">$foundElements</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$elements</span><span class="token punctuation">[</span><span class="token variable">$el</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$instruction</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/>    <span class="token punctuation">&#125;</span><br/>    <span class="token variable">$allEndWithZ</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token function">array_filter</span><span class="token punctuation">(</span><span class="token variable">$foundElements</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$fe</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br/>        <span class="token keyword">return</span> <span class="token function">str_ends_with</span><span class="token punctuation">(</span><span class="token variable">$fe</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$elementCount</span><span class="token punctuation">;</span><br/>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$allEndWithZ</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br/>        <span class="token variable">$found</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><br/>    <span class="token punctuation">&#125;</span><br/>    <span class="token variable">$nextElements</span> <span class="token operator">=</span> <span class="token variable">$foundElements</span><span class="token punctuation">;</span><br/><br/>    <span class="token variable">$instructionIndex</span><span class="token operator">++</span><span class="token punctuation">;</span><br/>    <span class="token variable">$steps</span><span class="token operator">++</span><span class="token punctuation">;</span><br/><span class="token punctuation">&#125;</span></code></pre>
<p>I ran it on the sample, no problem. Ran it on the real input and it just kept going. For a long time. I ran it for 45 minutes and it was still going. I spoke to <a href="https://zoeaubert.me">Zoe</a>, who had already finished part two, and the correct answer is 14 digits. Based on her maths, this method would take somewhere in the region of 500 hours. I knew there had to be some kind of number...things I could do to work out the answer but it was beyond me at this point.</p>
<h3>Part Two Redux</h3>
<p>After <a href="https://social.lol/@robb/111545115167242100">making a joke</a> about wanting a supercomputer on Mastodon, <a href="https://fosstodon.org/@chrishannah/111545160939769663">Chris asked</a> if I wanted a clue he'd seen on the subreddit. I had no idea how to solve this so yes, yes I did. The clue:</p>
<blockquote>
<p>Lowest Common Multiple</p>
</blockquote>
<p><em>Of course</em> the solution was a maths concept I'd heard of but never had a need to use (or I did and I just wasn't listening at school). "<em>The smallest positive integer that is divisible by both a and b</em>". As always, PHP has a function for this: <a href="https://www.php.net/manual/en/function.gmp-lcm.php"><code>git_lcm</code></a> but this only works for two numbers. I made a new file (<code>2v2.php</code>), extracted my path-to-Z logic into a function, collected the steps for each path, and calculated the lowest common multiple.</p>
<pre class="language-php"><code class="language-php"><span class="token variable">$allSteps</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/><br/><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$startingElements</span> <span class="token keyword">as</span> <span class="token variable">$element</span><span class="token punctuation">)</span><br/><span class="token punctuation">&#123;</span><br/>    <span class="token variable">$steps</span> <span class="token operator">=</span> <span class="token function">stepsToZ</span><span class="token punctuation">(</span><span class="token variable">$instructions</span><span class="token punctuation">,</span> <span class="token variable">$elements</span><span class="token punctuation">,</span> <span class="token variable">$element</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/>    <span class="token variable">$allSteps</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">gmp_init</span><span class="token punctuation">(</span><span class="token variable">$steps</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// numbers passed to `gmp_lcm` need to be converted to GMP</span><br/><span class="token punctuation">&#125;</span><br/><br/><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$allSteps</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br/><br/><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$allSteps</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$step</span><span class="token punctuation">)</span><br/><span class="token punctuation">&#123;</span><br/>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$index</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span><br/>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">gmp_init</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token function">gmp_lcm</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token variable">$step</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br/><span class="token punctuation">&#125;</span><br/><br/><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$result</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span></code></pre>
<p>I'm still not clear on <em>why</em> this gets the answer beyond <em>maths</em> but whatever, it's done. Onwards to day nine.</p>
<p>Update: Zoe has a <a href="https://zoeaubert.me/blog/advent-of-code-2023-day-08/">good explanation of why this is the answer</a>.</p>
<p>My solution is <a href="https://github.com/rknightuk/adventofcode/tree/main/2023/08">on GitHub</a>.</p>

</div>

<div>
[原文](https://rknight.me/blog/advent-of-code-2023-day-eight/)
</div>

